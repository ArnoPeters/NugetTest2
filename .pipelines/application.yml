## This generates an ever-increasing number based on the date and build. Useful for CI\CD scenario's.
name: $(date:yyyy.M.d)$(rev:.r) 

## GITHUB: specify the Pull Request Builds in yaml as below.
## Azure Devops: setup Pull Request Builds via "manage repositories" - "Branch Policies" in the Azure Devops UI instead. 
pr:
  branches:
    include:
    - main

## Azure Devops: The trigger specified below is only evaluated if the build is triggered by YAML, not by a Branch Policy
## Therefore the excluded trigger paths must also manually be added to the the Pull Request Builds in the Azure Devops UI. 
## The path filter for the branches below would be *; !/.vscode/*; !/docs/*; !/*.md 
trigger:
  branches:
    include: 
    - main
  paths:
    include: 
    - /.pipelines/*
    - /src/*
    exclude:
    - '/.vscode/*'
    - '/docs/*'
    - '/*.md'
    - '**/.editorconfig'
    - '**/.gitignore'

resources:
  repositories:
    - repository: yamlTemplates
      type: github
      name: "UserName/RepoName" # TODO: github Username/Reponame
      endpoint: #AzureDevopsGithubEndpointName under 'Project -> Service Connections'
      ref: 'refs/heads/main'

variables:
  # Files included in the variables section can ONLY have a 'variables' section, nothing more.
  - template: build/authors.yml
  #- group: '#GroupName' # Groups are linked to Azure Devops -> Pipelines > Library > Variable Group. Keep secrets there instead of in the actual source. 
  
  # Other values as key-value pair, or Groups won't work. 
  # https://learn.microsoft.com/en-us/azure/devops/pipelines/library/variable-groups?view=azure-devops&tabs=yaml#use-a-variable-group
  #- name: Key 
  #  value: 'Value'

pool: 
  vmImage: 'ubuntu-latest'

stages:
- stage: Build
  displayName: Buildstage
  jobs:
  - template: yaml/jobs/artifact-publishIACTemplates.yml@yamlTemplates
    parameters:
      applicationTemplatesFolder: '.pipelines/deploy'
  
  - template: yaml/jobs/AzDO_wrapWithGitVersion.yml@yamlTemplates
    parameters: 
      buildSteps: 
      - script: echo "Your buildsteps should go here!"